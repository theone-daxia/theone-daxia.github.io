<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>练手小项目-Pacman | 冲和</title><meta name=keywords content="go,终端小游戏"><meta name=description content="go编写的终端小游戏"><meta name=author content="冲和"><link rel=canonical href=https://theone-daxia.github.io/blog/code/go/pacman/><link crossorigin=anonymous href=/assets/css/stylesheet.min.6f60056d44d3f7eb69a4bc6c332b59960f3a995802bded244750232f33713c49.css integrity="sha256-b2AFbUTT9+tppLxsMytZlg86mVgCve0kR1AjLzNxPEk=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://theone-daxia.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://theone-daxia.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://theone-daxia.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://theone-daxia.github.io/apple-touch-icon.png><link rel=mask-icon href=https://theone-daxia.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.110.0"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-YBNN92PXEM"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-YBNN92PXEM",{anonymize_ip:!1})}</script><meta property="og:title" content="练手小项目-Pacman"><meta property="og:description" content="go编写的终端小游戏"><meta property="og:type" content="article"><meta property="og:url" content="https://theone-daxia.github.io/blog/code/go/pacman/"><meta property="og:image" content="https://theone-daxia.github.io/papermod-cover.png"><meta property="article:section" content="blog"><meta property="article:published_time" content="2023-02-20T00:00:00+00:00"><meta property="article:modified_time" content="2023-02-20T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://theone-daxia.github.io/papermod-cover.png"><meta name=twitter:title content="练手小项目-Pacman"><meta name=twitter:description content="go编写的终端小游戏"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blogs","item":"https://theone-daxia.github.io/blog/"},{"@type":"ListItem","position":2,"name":"练手小项目-Pacman","item":"https://theone-daxia.github.io/blog/code/go/pacman/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"练手小项目-Pacman","name":"练手小项目-Pacman","description":"go编写的终端小游戏","keywords":["go","终端小游戏"],"articleBody":"简介 这是一个用 go 编写的终端小游戏，设计很简单：\n玩家在一个迷宫中行走，上下左右控制方向； 吃蛋糕加一分，遇到怪物死亡（减一条命）且短暂延时后玩家在原始位置重生； 吃到加强弹药加十分且怪物在一段时间内变得愤怒， 没命或者按 Esc 键则退出游戏。 运行展示如下 我的项目代码：https://github.com/theone-daxia/pacman\n知识盘点 打开文件\nimport \"os\" file := \"maze01.txt\" os.Open(file) 读取文件内容\nimport \"bufio\" scanner := bufio.NewScanner(f) for scanner.Scan() { line := scanner.Text() maze = append(maze, line) } 调用外部命令\nimport \"os/exec\" cbTerm := exec.Command(\"stty\", \"cbreak\", \"-echo\") cbTerm.Stdin = os.Stdin err := cbTerm.Run() 终端模式\nCooked Mode Cbreak Mode Raw Mode cooked mode 是 Unix-style tty(比如 console) 处理输入的默认模式， 用户可以输入一行字符，在按回车前程序是看不到的。 在 cooked mode 下，数据在被提供给程序之前被预处理，而 raw mode 将数据按原样传递给程序而不解释任何特殊字符。\ncbreak mode 是介于 raw 和 cooked mode 之间的一种模式。与 cooked mode 不同，它一次只处理单个字符， 而不是强制等待整行然后一次性输入所有行。 与 raw mode 不同，像中止这样的击键（通常是 Control-C）仍然由终端处理并且会中断进程。\n使用 stty 命令设置终端行（带 - 关闭相应功能，不带 - 则打开相应功能） 关闭输入立即响应模式，打开回显 stty -cbreak echo 关闭回显，打开输入立即响应模式 stty cbreak -echo 从标准输入读取字符\nimport \"os\" func readInput() (string, error) { buffer := make([]byte, 100) cnt, err := os.Stdin.Read(buffer) if err != nil { return \"\", err } if cnt == 1 \u0026\u0026 buffer[0] == 0x1b { // 0x1b 是 esc 的16进制表示 return \"ESC\", nil } else if cnt \u003e= 3 { if buffer[0] == 0x1b \u0026\u0026 buffer[1] == '[' { switch buffer[2] { case 'A': return \"UP\", nil case 'B': return \"DOWN\", nil case 'C': return \"RIGHT\", nil case 'D': return \"LEFT\", nil } } } return \"\", nil } 处理转义序列\n转义序列以 Esc（0x1b）开头，后面跟一个或多个字符，一个转义序列对终端来说就是一个命令。\n使用 simpleansi 包处理转义序列\nimport \"github.com/danicat/simpleansi\" simpleansi.ClearScreen() // 清理屏幕 simpleansi.MoveCursor(row int, col int) // 移动光标 使用协程处理怪物移动、怪物变愤怒\n使用 channel 监听用户输入\n使用 Timer 处理怪物变愤怒的时间\n加载 .json 文件并存储在变量中\nimport ( \"os\" \"encoding/json\" ) func loadTheme(file string) error { f, err := os.Open(file) if err != nil { return err } defer f.Close() decoder := json.NewDecoder(f) err = decoder.Decode(\u0026theme) if err != nil { return err } return nil } 给命令行应用添加 flags\n// 添加两个 flag --theme-file --maze-file // 可以 --help 查看新添加的 flag 信息 // 使用示例：go rum main --theme-file theme/emoji.json import \"flag\" var ( themeFile = flag.String(\"theme-file\", \"theme/emoji.json\", \"path to custom theme file\") mazeFile = flag.String(\"maze-file\", \"maze01.txt\", \"path to custom maze file\") ) 使用 buffer 进行字符串连接\n使用 buffer 连接，只在初始化时分配内存，相比 + 方式更高效； 用 + 连接时，循环每次迭代都会进行内存分配。\nimport \"bytes\" func getLivesAsEmoji() string{ buf := bytes.Buffer{} for i := lives; i \u003e 0; i-- { buf.WriteString(cfg.Player) } return buf.String() } 使用锁来处理 data race\nsync.Mutex 处理吃到加强弹药后怪物的更改 sync.RWMutex 处理怪物状态的读取和写入 参考项目 pacgo ","wordCount":"345","inLanguage":"en","datePublished":"2023-02-20T00:00:00Z","dateModified":"2023-02-20T00:00:00Z","author":{"@type":"Person","name":"冲和"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://theone-daxia.github.io/blog/code/go/pacman/"},"publisher":{"@type":"Organization","name":"冲和","logo":{"@type":"ImageObject","url":"https://theone-daxia.github.io/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://theone-daxia.github.io/ accesskey=h title="冲和 (Alt + H)">冲和</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://theone-daxia.github.io/archives title=Archive><span>Archive</span></a></li><li><a href=https://theone-daxia.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://theone-daxia.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://theone-daxia.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://theone-daxia.github.io/follow_me title=关注我><span>关注我</span></a></li><li><a href=https://theone-daxia.github.io/blog/medical_beauty/project/ title=医美专区><span>医美专区</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://theone-daxia.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://theone-daxia.github.io/blog/>Blogs</a></div><h1 class=post-title>练手小项目-Pacman</h1><div class=post-description>go编写的终端小游戏</div><div class=post-meta><span title='2023-02-20 00:00:00 +0000 UTC'>February 20, 2023</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;冲和</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e7%ae%80%e4%bb%8b aria-label=简介>简介</a></li><li><a href=#%e7%9f%a5%e8%af%86%e7%9b%98%e7%82%b9 aria-label=知识盘点>知识盘点</a></li><li><a href=#%e5%8f%82%e8%80%83%e9%a1%b9%e7%9b%ae aria-label=参考项目>参考项目</a></li></ul></div></details></div><div class=post-content><h1 id=简介>简介<a hidden class=anchor aria-hidden=true href=#简介>#</a></h1><p>这是一个用 go 编写的终端小游戏，设计很简单：</p><pre><code>玩家在一个迷宫中行走，上下左右控制方向；
吃蛋糕加一分，遇到怪物死亡（减一条命）且短暂延时后玩家在原始位置重生；
吃到加强弹药加十分且怪物在一段时间内变得愤怒，
没命或者按 Esc 键则退出游戏。
</code></pre><p>运行展示如下
<img loading=lazy src=/img/code/pacman.png alt=pacman运行展示></p><p>我的项目代码：<a href=https://github.com/theone-daxia/pacman>https://github.com/theone-daxia/pacman</a></p><h1 id=知识盘点>知识盘点<a hidden class=anchor aria-hidden=true href=#知识盘点>#</a></h1><ul><li><p>打开文件</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;os&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>file</span> <span style=color:#f92672>:=</span> <span style=color:#e6db74>&#34;maze01.txt&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Open</span>(<span style=color:#a6e22e>file</span>)
</span></span></code></pre></div></li><li><p>读取文件内容</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;bufio&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>scanner</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>bufio</span>.<span style=color:#a6e22e>NewScanner</span>(<span style=color:#a6e22e>f</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> <span style=color:#a6e22e>scanner</span>.<span style=color:#a6e22e>Scan</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>line</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>scanner</span>.<span style=color:#a6e22e>Text</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>maze</span> = append(<span style=color:#a6e22e>maze</span>, <span style=color:#a6e22e>line</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li><li><p>调用外部命令</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;os/exec&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>cbTerm</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>exec</span>.<span style=color:#a6e22e>Command</span>(<span style=color:#e6db74>&#34;stty&#34;</span>, <span style=color:#e6db74>&#34;cbreak&#34;</span>, <span style=color:#e6db74>&#34;-echo&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>cbTerm</span>.<span style=color:#a6e22e>Stdin</span> = <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stdin</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>cbTerm</span>.<span style=color:#a6e22e>Run</span>()
</span></span></code></pre></div></li><li><p>终端模式</p><ul><li>Cooked Mode</li><li>Cbreak Mode</li><li>Raw Mode</li></ul><blockquote><p>cooked mode 是 Unix-style tty(比如 console) 处理输入的默认模式，
用户可以输入一行字符，在按回车前程序是看不到的。
在 cooked mode 下，数据在被提供给程序之前被预处理，而 raw mode 将数据按原样传递给程序而不解释任何特殊字符。</p></blockquote><blockquote><p>cbreak mode 是介于 raw 和 cooked mode 之间的一种模式。与 cooked mode 不同，它一次只处理单个字符，
而不是强制等待整行然后一次性输入所有行。
与 raw mode 不同，像中止这样的击键（通常是 Control-C）仍然由终端处理并且会中断进程。</p></blockquote><ul><li>使用 stty 命令设置终端行（带 <em>-</em> 关闭相应功能，不带 <em>-</em> 则打开相应功能）<ul><li>关闭输入立即响应模式，打开回显 <code>stty -cbreak echo</code></li><li>关闭回显，打开输入立即响应模式 <code>stty cbreak -echo</code></li></ul></li></ul></li><li><p>从标准输入读取字符</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;os&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>readInput</span>() (<span style=color:#66d9ef>string</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>buffer</span> <span style=color:#f92672>:=</span> make([]<span style=color:#66d9ef>byte</span>, <span style=color:#ae81ff>100</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cnt</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stdin</span>.<span style=color:#a6e22e>Read</span>(<span style=color:#a6e22e>buffer</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>cnt</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>buffer</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x1b</span> { <span style=color:#75715e>// 0x1b 是 esc 的16进制表示
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;ESC&#34;</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>cnt</span> <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>3</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>buffer</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x1b</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>buffer</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;[&#39;</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>switch</span> <span style=color:#a6e22e>buffer</span>[<span style=color:#ae81ff>2</span>] {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;A&#39;</span>:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;UP&#34;</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;B&#39;</span>:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;DOWN&#34;</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;C&#39;</span>:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;RIGHT&#34;</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;D&#39;</span>:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;LEFT&#34;</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li><li><p>处理转义序列</p><p>转义序列以 Esc（0x1b）开头，后面跟一个或多个字符，一个转义序列对终端来说就是一个命令。</p><p>使用 simpleansi 包处理转义序列</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;github.com/danicat/simpleansi&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>simpleansi</span>.<span style=color:#a6e22e>ClearScreen</span>() <span style=color:#75715e>// 清理屏幕
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>simpleansi</span>.<span style=color:#a6e22e>MoveCursor</span>(<span style=color:#a6e22e>row</span> <span style=color:#66d9ef>int</span>, <span style=color:#a6e22e>col</span> <span style=color:#66d9ef>int</span>) <span style=color:#75715e>// 移动光标
</span></span></span></code></pre></div></li><li><p>使用协程处理怪物移动、怪物变愤怒</p></li><li><p>使用 channel 监听用户输入</p></li><li><p>使用 Timer 处理怪物变愤怒的时间</p></li><li><p>加载 .json 文件并存储在变量中</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;os&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;encoding/json&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>loadTheme</span>(<span style=color:#a6e22e>file</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>f</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Open</span>(<span style=color:#a6e22e>file</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>f</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>decoder</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>NewDecoder</span>(<span style=color:#a6e22e>f</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>decoder</span>.<span style=color:#a6e22e>Decode</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>theme</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li><li><p>给命令行应用添加 flags</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// 添加两个 flag --theme-file --maze-file
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 可以 --help 查看新添加的 flag 信息
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 使用示例：go rum main --theme-file theme/emoji.json
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;flag&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> (
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>themeFile</span> = <span style=color:#a6e22e>flag</span>.<span style=color:#a6e22e>String</span>(<span style=color:#e6db74>&#34;theme-file&#34;</span>, <span style=color:#e6db74>&#34;theme/emoji.json&#34;</span>, <span style=color:#e6db74>&#34;path to custom theme file&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mazeFile</span>  = <span style=color:#a6e22e>flag</span>.<span style=color:#a6e22e>String</span>(<span style=color:#e6db74>&#34;maze-file&#34;</span>, <span style=color:#e6db74>&#34;maze01.txt&#34;</span>, <span style=color:#e6db74>&#34;path to custom maze file&#34;</span>)
</span></span><span style=display:flex><span>)
</span></span></code></pre></div></li><li><p>使用 buffer 进行字符串连接</p><p>使用 buffer 连接，只在初始化时分配内存，相比 + 方式更高效；
用 + 连接时，循环每次迭代都会进行内存分配。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;bytes&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>getLivesAsEmoji</span>() <span style=color:#66d9ef>string</span>{
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>buf</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>bytes</span>.<span style=color:#a6e22e>Buffer</span>{}
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>lives</span>; <span style=color:#a6e22e>i</span> &gt; <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>--</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>buf</span>.<span style=color:#a6e22e>WriteString</span>(<span style=color:#a6e22e>cfg</span>.<span style=color:#a6e22e>Player</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>buf</span>.<span style=color:#a6e22e>String</span>()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li><li><p>使用锁来处理 data race</p><ul><li>sync.Mutex 处理吃到加强弹药后怪物的更改</li><li>sync.RWMutex 处理怪物状态的读取和写入</li></ul></li></ul><h1 id=参考项目>参考项目<a hidden class=anchor aria-hidden=true href=#参考项目>#</a></h1><ul><li><a href=https://github.com/danicat/pacgo>pacgo</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://theone-daxia.github.io/tags/go/>go &^</a></li><li><a href=https://theone-daxia.github.io/tags/%E7%BB%88%E7%AB%AF%E5%B0%8F%E6%B8%B8%E6%88%8F/>终端小游戏</a></li></ul><nav class=paginav><a class=next href=https://theone-daxia.github.io/blog/code/mac/homebrew/><span class=title>Next Page »</span><br><span>Homebrew 相关问题</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://theone-daxia.github.io/>冲和</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>